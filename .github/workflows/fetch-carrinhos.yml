name: Fetch fornecedorus carrinhos

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  buscar:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Obter JSON remoto
        run: |
          curl -sS -A "Mozilla/5.0" "https://fornecedoruss.com.br/webservice/carrinhos-abandonados/" -o carrinhos.json
          ls -lh carrinhos.json

      - name: Commit & push do JSON (se mudou)
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add carrinhos.json
          # só comita se houve mudanças
          if ! git diff --quiet --staged; then
            git commit -m "Update carrinhos.json from fornecedor"
            git push origin HEAD:main
          else
            echo "sem mudanças no JSON — nada a commitar"
          fi
